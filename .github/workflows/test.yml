name: Sync with CodingStudy

on:
  push:
    branches:
      - main  # main 브랜치에 푸시될 때 트리거

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3  # 레포지토리의 코드를 체크아웃

      - name: Set up Git
        run: |
          git config --global user.name "YHK[BOT]"
          git config --global user.email "YHK[BOT]@no.reply"

      - name: Add Real repo as remote
        env:
          GITHUB_TOKEN: ${{secrets.AUTO_PS_PUSH}}
        run: |
          git remote set-url origin https://github.com/ghrbs0437/CodingStudy.git
         #  git remote add origin https://github.com/ghrbs0437/CodingStudy.git  # Real 레포지토리를 리모트로 추가

      - name: Get the last commit message
        id: get_commit_msg
        run: |
          COMMIT_MSG=$(git log -1 --pretty=%B)  # 마지막 커밋 메시지를 가져옴
          echo "::set-output name=msg::$COMMIT_MSG"  # 커밋 메시지를 저장

      - name: Sync to repo's PS folder
        env:
          GITHUB_TOKEN: ${{secrets.AUTO_PS_PUSH}}
        run: |
          git branch -M main
          
          mkdir -p PS/SWEA PS/백준
          rsync -av --delete ./SWEA PS/
          git add PS/  # ps 폴더에 변경된 파일들을 추가
          git commit -m "${{ steps.get_commit_msg.outputs.msg }}" 
          git push origin main
